<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>CRUD on Android with Firebase API</title>
  <meta name="description" content="How did I do
" />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="canonical" href="http://localhost:4000/android/2015/09/09/firebase-crud-android.html">

  <link rel="shortcut icon" href="/assets/images/favicon.ico">
<!--  <link rel="stylesheet" href=""> -->
  <link rel="stylesheet" href="http://brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" >

  <link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
  <link rel="stylesheet" type="text/css" media="print" href="/css/print.css" />
  <link rel="stylesheet" type="text/css"  href="/css/prism.css" />
  <script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>

  <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
  <script type="text/javascript" src="/assets/js/index.js"></script>
  <script type="text/javascript" src="/assets/js/readingTime.min.js"></script>
  <script type="text/javascript" src="/assets/js/prism.js"></script>
</head>

  <body itemscope itemtype="http://schema.org/Article">
    <!-- header start -->

<a href="http://localhost:4000" class="logo-readium"><span class="logo" style="background-image: url(/assets/images/logo.jpg)"></span></a>

<!-- header end -->

    <main class="content" role="main">
      <article class="post">
        
        <div class="article-image">
          <div class="post-image-image" style="background-image: url(/assets/article_images/firebase-crud-android/bg.jpg)">
            Article Image
          </div>
          <div class="post-meta">
            <h1 class="post-title">CRUD on Android with Firebase API</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(/assets/images/author.jpg)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person">Shrikanth</h4>
              on
              <time datetime="2015-09-09 14:34">09 Sep 2015</time>
              <!-- , tagged on <span class="post-tag-">, <a href="/tag/"></a></span> -->
            </div>
            <div style="text-align:center">
              <a href="#topofpage" class="topofpage"><i class="fa fa-angle-down"></i></a>
            </div>
          </div>
        </div>
        <script>
          (function ($) {
              "use strict";
              $(document).ready(function(){
                  var $window = $(window),
                      $image = $('.post-image-image');
                  $window.on('scroll', function() {
                      var top = $window.scrollTop();

                      if (top < 0 || top > 1500) { return; }
                      $image
                          .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
                          .css('opacity', 1-Math.max(top/700, 0));
                  });
                  $window.trigger('scroll');

                  var height = $('.article-image').height();
                      $('.post-content').css('padding-top', height + 'px');

                  $(function() {
                    $('a[href*=#]:not([href=#])').click(function() {
                      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
                        var target = $(this.hash);
                        target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
                        if (target.length) {
                          $('html,body').animate({
                            scrollTop: target.offset().top
                          }, 500);
                          return false;
                        }
                      }
                    });
                  });

              });

          }(jQuery));
        </script>
        
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          <p>Firebase provides a powerful API to <strong>store, retrieve and sync</strong> data in realtime, which paves way for an accelerated development reducing the pain of setting up your backend. In this post we will get a quick glance of making a CRUD with <a href="https://www.firebase.com/docs/android/">Firebase Android SDK</a>. Firebase also provides you with a <a href="https://www.firebase.com/docs/android/quickstart.html">Quick Start</a> guide to get on with its SDKs. </p>

<hr>

<p>Once you have an account with <a href="https://www.firebase.com/">Firebase</a>, create an <code>app</code> and note down the <code>app&#39;s</code> URL. This <code>app</code> URL will be used in our android application as the base URL to firebase.</p>

<h4>Adding Dependencies</h4>

<blockquote>
<p>app/build.gradle
<div>
  <pre data-line=''><code class='language-javascript'>dependencies {
    compile &#39;com.firebase:firebase-client-android:2.3.1+&#39;
}</code></pre>
</div></p>
</blockquote>

<p>Incase you end up with build errors, </p>

<div>
  <pre data-line=''><code class='language-javascript'>android {
    ...
    packagingOptions {
    exclude &#39;META-INF/LICENSE&#39;
    exclude &#39;META-INF/LICENSE-FIREBASE.txt&#39;
    exclude &#39;META-INF/NOTICE&#39;
    }
}</code></pre>
</div>

<hr>

<h4>Adding Permissions</h4>

<blockquote>
<p>app/src/main/AndroidManifest.xml 
<div>
  <pre data-line=''><code class='language-markup'>&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</code></pre>
</div></p>
</blockquote>

<hr>

<h4>Necessary Layout Components</h4>

<p>Two <code>EditText</code> components,  a <code>ListView</code> and a <code>Button</code>. These <code>EditText</code> components holds the <code>name</code>(key) and the <code>message</code>(value) to be saved. <code>Button</code> is used to trigger the save action using <strong>Firebase</strong> sdk and a <code>ListView</code> to display the data.
<div>
  <pre data-line=''><code class='language-markup'>&lt;EditText
    android:layout<em>width=&quot;fill</em>parent&quot;
    android:layout<em>height=&quot;60dp&quot;
    android:hint=&quot;Enter Name&quot;
    android:id=&quot;@+id/name&quot;
    android:layout</em>marginTop=&quot;10dp&quot;
    android:layout<em>alignParentLeft=&quot;true&quot;
    android:layout</em>alignParentStart=&quot;true&quot;/&gt;
&lt;EditText
    android:layout<em>width=&quot;fill</em>parent&quot;
    android:layout<em>height=&quot;60dp&quot;
    android:hint=&quot;Enter Message&quot;
    android:layout</em>marginTop=&quot;10dp&quot;
    android:id=&quot;@+id/message&quot;
    android:layout<em>below=&quot;@+id/name&quot;/&gt;
&lt;Button
    android:layout</em>width=&quot;wrap<em>content&quot;
    android:layout</em>height=&quot;wrap<em>content&quot;
    android:text=&quot;Save&quot;
    android:id=&quot;@+id/save&quot;
    android:layout</em>below=&quot;@+id/message&quot;
    android:layout<em>marginTop=&quot;10dp&quot;
    android:layout</em>centerHorizontal=&quot;true&quot;/&gt;
&lt;ListView
    android:layout<em>width=&quot;wrap</em>content&quot;
    android:layout<em>height=&quot;fill</em>parent&quot;
    android:id=&quot;@+id/listView&quot;
    android:layout<em>below=&quot;@+id/save&quot;
    android:layout</em>alignParentLeft=&quot;true&quot;
    android:layout_alignParentStart=&quot;true&quot;/&gt;</code></pre>
</div></p>

<hr>

<h4>Saving data on Firebase - Create</h4>

<p>Declare necessary attributes.</p>

<div>
  <pre data-line=''><code class='language-javascript'>Button save;
static Firebase myFirebaseRef;
EditText nameEditText;
EditText messageEditText;
ProgressBar progressBar;
static final String TAG = &quot;Main Acvity&quot;;
ArrayAdapter&lt;String&gt; valuesAdapter;
ArrayList&lt;String&gt; displayArray;
ArrayList&lt;String&gt; keysArray;
ListView listView;</code></pre>
</div>

<p>The OnCreate Function</p>

<div>
  <pre data-line=''><code class='language-javascript'>@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);

    /*View bindings*/
    save = (Button)findViewById(R.id.save);
    nameEditText = (EditText)findViewById(R.id.name);
    messageEditText= (EditText)findViewById(R.id.message);
    progressBar = (ProgressBar)findViewById(R.id.progressBar);
    listView = (ListView)findViewById(R.id.listView);

    /*Variable Initialization*/
    displayArray  = new ArrayList&lt;&gt;();
    keysArray = new ArrayList&lt;&gt;();
    valuesAdapter = new ArrayAdapter&lt;String&gt;(this,android.R.layout.simple_list_item_1,android.R.id.text1,displayArray);
    listView.setAdapter(valuesAdapter);
    /*listView.setOnItemClickListener(itemClickListener);*/
    save.setOnClickListener(this);

    /*Firebase Initialization*/
    Firebase.setAndroidContext(this);
    myFirebaseRef = new Firebase(&quot;&lt;appurl&gt;&quot;);
    /*myFirebaseRef.addChildEventListener(childEventListener);*/
}</code></pre>
</div>

<p>Adding click Listener to fire save action</p>

<div>
  <pre data-line=''><code class='language-javascript'>@Override
public void onClick(View v) {
    switch (v.getId()){
        case R.id.save:
            String nameString = nameEditText.getText().toString();
            String messageString = messageEditText.getText().toString();
            save(nameString,messageString);
        break;
    }
}

private void save(String name,String message){
    myFirebaseRef.child(name).setValue(message, new Firebase.CompletionListener() {
        @Override
        public void onComplete(FirebaseError firebaseError, Firebase firebase) {
            nameEditText.setText(&quot;&quot;);
            messageEditText.setText(&quot;&quot;);
        }
    });
}</code></pre>
</div>

<p>We have saved our data to firebase and on our onComplete method above we empty the <code>edittext</code> boxes. So where do we actually read our data and update the view?</p>

<hr>

<h4>Read data from Firebase - Read</h4>

<p><strong>Firebase</strong> provides a ChildEventListener which pops up when ever a change occurs to the specified child to which the event is bound. In our case we bind it to the <code>myFirebaseRef</code>, which is commented out initially on our <code>onCreate</code> method. </p>

<p>Events which we could listen to are <code>onChildAdded</code>, <code>onChildChanged</code>, <code>onChildRemoved</code>, <code>onChildMoved</code>, <code>onCancelled</code>. </p>

<div>
  <pre data-line=''><code class='language-javascript'>ChildEventListener childEventListener = new ChildEventListener() {
    @Override
    public void onChildAdded(DataSnapshot dataSnapshot, String s) {
        Log.d(TAG, dataSnapshot.getKey() + &quot;:&quot; + dataSnapshot.getValue().toString());
        String keyAndValue = &quot;Key: &quot; +dataSnapshot.getKey().toString() + &quot;\t Value: &quot; +     dataSnapshot.getValue().toString();
        displayArray.add(keyAndValue);
        keysArray.add(dataSnapshot.getKey().toString());
        updateListView();
    }
    @Override
    public void onChildChanged(DataSnapshot dataSnapshot, String s) {}
    @Override
    public void onChildRemoved(DataSnapshot dataSnapshot) {}
    @Override
    public void onChildMoved(DataSnapshot dataSnapshot, String s) { }
    @Override
    public void onCancelled(FirebaseError firebaseError) {}
};

private void updateListView(){
    valuesAdapter.notifyDataSetChanged();
    listView.invalidate();
    Log.d(TAG, &quot;Length: &quot; + displayArray.size());
}</code></pre>
</div>

<p>Whenever a new child is added <code>onChildAdded</code> will get triggered and the view is updated corresponding to the received data.</p>

<hr>

<h4>Listen for changes in the child - Update</h4>

<p>As we had seen, the above code provides a method to listen on changes made to the child data. We update our code on <code>onChildChanged</code> method to publish updates and show it to the user.</p>

<div>
  <pre data-line=''><code class='language-javascript'>@Override
public void onChildChanged(DataSnapshot dataSnapshot, String s) {
    String changedKey = dataSnapshot.getKey();
    int changedIndex = keysArray.indexOf(changedKey);
    String keyAndValue = &quot;Key: &quot; +dataSnapshot.getKey().toString() + &quot;\t Value: &quot; + dataSnapshot.getValue().toString();
    displayArray.set(changedIndex,keyAndValue);
    updateListView();
}</code></pre>
</div>

<hr>

<h4>Deleting a child - Delete</h4>

<p>Now we uncomment <code>itemClickListener</code> for the listview. On click of an item in list view we delete the data based on the given <code>name</code>(Key).</p>

<div>
  <pre data-line=''><code class='language-javascript'>AdapterView.OnItemClickListener itemClickListener = new AdapterView.OnItemClickListener() {
    @Override
    public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) {
        String clickedKey = keysArray.get(position);
        myFirebaseRef.child(clickedKey).removeValue();
    }
};</code></pre>
</div>

<p>And again we override the <code>onChildRemoved</code> function and update the view</p>

<div>
  <pre data-line=''><code class='language-javascript'>@Override
public void onChildRemoved(DataSnapshot dataSnapshot) {
    String deletedKey = dataSnapshot.getKey();
    int removedIndex = keysArray.indexOf(deletedKey);
    keysArray.remove(removedIndex);
    displayArray.remove(removedIndex);
    updateListView();
}</code></pre>
</div>

<hr>

<p>You can find the source code of the entire sample over here, <a href="https://github.com/shrikanthkr/FirebaseCRUD">Firebase CRUD</a> with few miscellaneous functions,</p>

        </section>
        <footer class="post-footer">
          <section class="share">
            
              
                <a class="icon-twitter" href="http://twitter.com/share?text=CRUD+on+Android+with+Firebase+API&amp;url=http://localhost:4000/android/2015/09/09/firebase-crud-android"
                  onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                </a>
              
            
              
            
          </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="isLeft">
            <h5 class="index-headline featured"><span>Written by</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(/assets/images/author.jpg)">Blog Logo</div>
              <h4>Shrikanth</h4>
              <p class="bio"></p>
              <hr>
              <p class="published">Published <time datetime="2015-09-09 14:34">09 Sep 2015</time></p>
            </section>
          </div>
          
          <div class="isRight">
            <h5 class="index-headline featured"><span>Supported by</span></h5>
            <footer class="site-footer">
              <section class="poweredby">Proudly published with <a href="http://jekyllrb.com"> Jekyll</a></section>
              <a class="subscribe" href="/feed.xml"> <span class="tooltip"> <i class="fa fa-rss"></i> You should subscribe to my feed.</span></a>
              <div class="inner">
                <section class="copyright">All content copyright <a href="/">Shrikanth</a> &copy; 2014<br>All rights reserved.</section>
              </div>
            </footer>
          </div>
        </div>
      </article>
    </main>
    <div class="bottom-closer">
      <div class="background-closer-image"  style="background-image: url(/assets/images/background.jpg)">
      Image
    </div>
    <div class="inner">
      <h1 class="blog-title">Blog</h1>
      <h2 class="blog-description">How did I do
</h2>
      <a href="/" class="btn">Back to Overview</a>
    </div>
    </div>
  </body>
</html>
